version: '3.8'

services:
  cyrus:
    image: ghcr.io/cyrusimap/cyrus-docker-test-server:latest
    container_name: cyrus-test
    ports:
      - "8802:8080"  # HTTP (CalDAV/CardDAV/JMAP)
      - "8143:8143"  # IMAP
      - "8001:8001"  # Management API
    environment:
      - DEFAULTDOMAIN=example.com
      - SERVERNAME=cyrus-test
    # No volumes - let data be ephemeral for testing
    # This ensures each start is fresh with newly created users
    healthcheck:
      test: ["CMD", "curl", "-s", "http://localhost:8080/"]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 30s
